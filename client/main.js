import { Template } from 'meteor/templating';
import { ReactiveVar } from 'meteor/reactive-var';
import { Mongo } from 'meteor/mongo';
import './main.html';

//Insert the address at which your contract has been published in this variable
contractAddress = "" // for example: "0xea842c9635eb8863f49a99b3c66498db4b7740ae"

//Set the Interface-ABI and bytecode to the following two variables
ABIArray = [{"constant":true,"inputs":[],"name":"determineMTD","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"registry","outputs":[{"name":"mtd","type":"uint256"},{"name":"entityName","type":"string"},{"name":"currentTrip","type":"uint256"},{"name":"active","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"displayTrips","outputs":[{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"allEntity","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"_transporterAddr","type":"address"},{"name":"_distributorAddr","type":"address"},{"name":"_medicineIndex","type":"uint256"}],"name":"startTrip","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":false,"inputs":[{"name":"_medicineIndex","type":"uint256"},{"name":"_medicineName","type":"string"},{"name":"_maxTemp","type":"uint256"},{"name":"_minTemp","type":"uint256"}],"name":"addMedicine","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"getDistributor","outputs":[{"name":"","type":"address"},{"name":"","type":"string"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"_tripIndex","type":"uint256"}],"name":"lengthData","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"getUsername","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"meds","outputs":[{"name":"medicineIndex","type":"uint256"},{"name":"medicineName","type":"string"},{"name":"maxTemp","type":"uint256"},{"name":"minTemp","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"getTransporters","outputs":[{"name":"","type":"address"},{"name":"","type":"string"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"_temp","type":"uint256"},{"name":"_lat","type":"string"},{"name":"_lon","type":"string"}],"name":"sendData","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":false,"inputs":[{"name":"_tripIndex","type":"uint256"},{"name":"_tripStatus","type":"uint256"}],"name":"acceptTrip","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[],"name":"lengthTrips","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"entityLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"_entityAddress","type":"address"}],"name":"viewEntity","outputs":[{"name":"","type":"address"},{"name":"","type":"string"},{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"_mtd","type":"uint256"},{"name":"_entityAddr","type":"address"},{"name":"_entityName","type":"string"}],"name":"addEntity","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[{"name":"_tripIndex","type":"uint256"},{"name":"_dataIndex","type":"uint256"}],"name":"viewData","outputs":[{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"_index","type":"uint256"}],"name":"viewMedicine","outputs":[{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"tripIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"trips","outputs":[{"name":"tripIndex","type":"uint256"},{"name":"manufacturerAddr","type":"address"},{"name":"transporterAddr","type":"address"},{"name":"distributorAddr","type":"address"},{"name":"medicineIndex","type":"uint256"},{"name":"tripStatus","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"medicineLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"inputs":[],"payable":false,"type":"constructor","stateMutability":"nonpayable"}]
code = "6060604052600060055560016006556002600755600360085534156200002457600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506008600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001819055506040805190810160405280600581526020017f41646d696e000000000000000000000000000000000000000000000000000000815250600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010190805190602001906200013a929190620001af565b50600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600401805480600101828162000191919062000236565b916000526020600020900160005b6001909190915055505b6200028d565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620001f257805160ff191683800117855562000223565b8280016001018555821562000223579182015b828111156200022257825182559160200191906001019062000205565b5b50905062000232919062000265565b5090565b81548183558181151162000260578183600052602060002091820191016200025f919062000265565b5b505050565b6200028a91905b80821115620002865760008160009055506001016200026c565b5090565b90565b613315806200029d6000396000f30060606040523615610126576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630205e9eb1461012b578063038defd71461015457806322bc6be81461023857806324fd6b441461042a578063385515421461048d57806353811fad146104ee57806360166fe3146105665780636377ffee14610636578063681f3e6d1461066d578063692e5a74146106fc5780637dbda554146107ca578063919109581461089a57806397cc2b8c14610943578063adf320fa1461096f578063ae2d25f414610998578063b217b76a146109c1578063b693768714610aae578063b8cc41cb14610b33578063ddfe2e8714610c5b578063e1b1bc5914610d0d578063f6824a7c14610d36578063fdcb87f714610e14575b600080fd5b341561013657600080fd5b61013e610e3d565b6040518082815260200191505060405180910390f35b341561015f57600080fd5b61018b600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610e88565b60405180858152602001806020018481526020018381526020018281038252858181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156102265780601f106101fb57610100808354040283529160200191610226565b820191906000526020600020905b81548152906001019060200180831161020957829003601f168201915b50509550505050505060405180910390f35b341561024357600080fd5b6102596004808035906020019091905050610eb7565b604051808060200180602001806020018060200187815260200186815260200185810385528b818151815260200191508051906020019080838360005b838110156102b25780820151818401525b602081019050610296565b50505050905090810190601f1680156102df5780820380516001836020036101000a031916815260200191505b5085810384528a818151815260200191508051906020019080838360005b838110156103195780820151818401525b6020810190506102fd565b50505050905090810190601f1680156103465780820380516001836020036101000a031916815260200191505b50858103835289818151815260200191508051906020019080838360005b838110156103805780820151818401525b602081019050610364565b50505050905090810190601f1680156103ad5780820380516001836020036101000a031916815260200191505b50858103825288818151815260200191508051906020019080838360005b838110156103e75780820151818401525b6020810190506103cb565b50505050905090810190601f1680156104145780820380516001836020036101000a031916815260200191505b509a505050505050505050505060405180910390f35b341561043557600080fd5b61044b6004808035906020019091905050611556565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561049857600080fd5b6104ec600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506115f7565b005b34156104f957600080fd5b610564600480803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035906020019091908035906020019091905050611a53565b005b341561057157600080fd5b6105876004808035906020019091905050611b87565b604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001828103825283818151815260200191508051906020019080838360005b838110156105fa5780820151818401525b6020810190506105de565b50505050905090810190601f1680156106275780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b341561064157600080fd5b6106576004808035906020019091905050611dc9565b6040518082815260200191505060405180910390f35b341561067857600080fd5b610680611ec9565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156106c15780820151818401525b6020810190506106a5565b50505050905090810190601f1680156106ee5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561070757600080fd5b61071d6004808035906020019091905050611fb2565b60405180858152602001806020018481526020018381526020018281038252858181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156107b85780601f1061078d576101008083540402835291602001916107b8565b820191906000526020600020905b81548152906001019060200180831161079b57829003601f168201915b50509550505050505060405180910390f35b34156107d557600080fd5b6107eb6004808035906020019091905050611fe1565b604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001828103825283818151815260200191508051906020019080838360005b8381101561085e5780820151818401525b602081019050610842565b50505050905090810190601f16801561088b5780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b34156108a557600080fd5b610941600480803590602001909190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506122ac565b005b341561094e57600080fd5b61096d60048080359060200190919080359060200190919050506124fb565b005b341561097a57600080fd5b610982612667565b6040518082815260200191505060405180910390f35b34156109a357600080fd5b6109ab6126b5565b6040518082815260200191505060405180910390f35b34156109cc57600080fd5b6109f8600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506126c3565b604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001838152602001828103825284818151815260200191508051906020019080838360005b83811015610a715780820151818401525b602081019050610a55565b50505050905090810190601f168015610a9e5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b3415610ab957600080fd5b610b31600480803590602001909190803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506127ff565b005b3415610b3e57600080fd5b610b5d6004808035906020019091908035906020019091905050612962565b604051808681526020018060200180602001858152602001848152602001838103835287818151815260200191508051906020019080838360005b83811015610bb45780820151818401525b602081019050610b98565b50505050905090810190601f168015610be15780820380516001836020036101000a031916815260200191505b50838103825286818151815260200191508051906020019080838360005b83811015610c1b5780820151818401525b602081019050610bff565b50505050905090810190601f168015610c485780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b3415610c6657600080fd5b610c7c6004808035906020019091905050612cbb565b6040518085815260200180602001848152602001838152602001828103825285818151815260200191508051906020019080838360005b83811015610ccf5780820151818401525b602081019050610cb3565b50505050905090810190601f168015610cfc5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b3415610d1857600080fd5b610d20612f97565b6040518082815260200191505060405180910390f35b3415610d4157600080fd5b610d576004808035906020019091905050612f9d565b604051808781526020018673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001838152602001828152602001965050505050505060405180910390f35b3415610e1f57600080fd5b610e27613039565b6040518082815260200191505060405180910390f35b6000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015490505b90565b600160205280600052604060002060009150905080600001549080600101908060030154908060050154905084565b610ebf613087565b610ec7613087565b610ecf613087565b610ed7613087565b6000806001600060046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018b815481101515610f3157fe5b906000526020600020900160005b5054815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001016001600060046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018c81548110151561100757fe5b906000526020600020900160005b5054815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001016001600060046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018d8154811015156110dd57fe5b906000526020600020900160005b5054815260200190815260200160002060030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001016002600060046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018e8154811015156111b357fe5b906000526020600020900160005b5054815260200190815260200160002060040154815260200190815260200160002060010160046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018d81548110151561123957fe5b906000526020600020900160005b505481526020019081526020016000206000015460046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018e8154811015156112ae57fe5b906000526020600020900160005b5054815260200190815260200160002060060154858054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113655780601f1061133a57610100808354040283529160200191611365565b820191906000526020600020905b81548152906001019060200180831161134857829003601f168201915b50505050509550848054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114015780601f106113d657610100808354040283529160200191611401565b820191906000526020600020905b8154815290600101906020018083116113e457829003601f168201915b50505050509450838054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561149d5780601f106114725761010080835404028352916020019161149d565b820191906000526020600020905b81548152906001019060200180831161148057829003601f168201915b50505050509350828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156115395780601f1061150e57610100808354040283529160200191611539565b820191906000526020600020905b81548152906001019060200180831161151c57829003601f168201915b505050505092509550955095509550955095505b91939550919395565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156115b357600080fd5b6003828154811015156115c257fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b919050565b600654600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015414801561168d5750600754600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154145b80156116dc5750600854600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154145b80156116fd5750806002600083815260200190815260200160002060000154145b151561170857600080fd5b600554600460006005548152602001908152602001600020600001819055503360046000600554815260200190815260200160002060010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508260046000600554815260200190815260200160002060020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508160046000600554815260200190815260200160002060030160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508060046000600554815260200190815260200160002060040181905550600060046000600554815260200190815260200160002060060181905550600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020180548060010182816118bb919061309b565b916000526020600020900160005b60055490919091505550600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018054806001018281611927919061309b565b916000526020600020900160005b6005549091909150555060018060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060050181905550600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020180548060010182816119da919061309b565b916000526020600020900160005b60055490919091505550600554600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600301819055506005600081548092919060010191905055505b505050565b60018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141515611aa357600080fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206004018054806001018281611af7919061309b565b916000526020600020900160005b86909190915055506080604051908101604052808581526020018481526020018381526020018281525060026000868152602001908152602001600020600082015181600001556020820151816001019080519060200190611b689291906130c7565b5060408201518160020155606082015181600301559050505b50505050565b6000611b91613087565b60018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154148015611c5f5750600360016000600386815481101515611bf257fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154145b1515611c6a57600080fd5b600383815481101515611c7957fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660016000600386815481101515611cb957fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101808054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611db85780601f10611d8d57610100808354040283529160200191611db8565b820191906000526020600020905b815481529060010190602001808311611d9b57829003601f168201915b50505050509050915091505b915091565b60003373ffffffffffffffffffffffffffffffffffffffff166004600084815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161480611e9c57503373ffffffffffffffffffffffffffffffffffffffff166004600084815260200190815260200160002060030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b1515611ea757600080fd5b600460008381526020019081526020016000206005018054905090505b919050565b611ed1613087565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611fa75780601f10611f7c57610100808354040283529160200191611fa7565b820191906000526020600020905b815481529060010190602001808311611f8a57829003601f168201915b505050505090505b90565b600260205280600052604060002060009150905080600001549080600101908060020154908060030154905084565b6000611feb613087565b60018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541480156120b9575060026001600060038681548110151561204c57fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154145b8015612142575060018060006003868154811015156120d457fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206005015414155b151561214d57600080fd5b60038381548110151561215c57fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166001600060038681548110151561219c57fe5b906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101808054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561229b5780601f106122705761010080835404028352916020019161229b565b820191906000526020600020905b81548152906001019060200180831161227e57829003601f168201915b50505050509050915091505b915091565b6000809050600754600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015414156124f4576002600060046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600301548152602001908152602001600020600401548152602001908152602001600020600201548411806123e657506002600060046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206003015481526020019081526020016000206004015481526020019081526020016000206003015484105b156123f057600190505b60046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600301548152602001908152602001600020600501805480600101828161245a9190613147565b916000526020600020906005020160005b60a0604051908101604052808881526020018781526020018681526020014281526020018581525090919091506000820151816000015560208201518160010190805190602001906124be9291906130c7565b5060408201518160020190805190602001906124db9291906130c7565b5060608201518160030155608082015181600401555050505b5b50505050565b3373ffffffffffffffffffffffffffffffffffffffff166004600084815260200190815260200160002060030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614151561256b57600080fd5b8060046000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201858154811015156125bf57fe5b906000526020600020900160005b50548152602001908152602001600020600601819055506000600160006004600086815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600501819055505b5050565b6000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018054905090505b90565b600060038054905090505b90565b60006126cd613087565b600083600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156127ea5780601f106127bf576101008083540402835291602001916127ea565b820191906000526020600020905b8154815290600101906020018083116127cd57829003601f168201915b505050505091509250925092505b9193909250565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561285a57600080fd5b82600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000018190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010190805190602001906128f7929190613179565b506003805480600101828161290c91906131f9565b916000526020600020900160005b84909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505b505050565b600061296c613087565b612974613087565b6000803373ffffffffffffffffffffffffffffffffffffffff166004600089815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161480612a4857503373ffffffffffffffffffffffffffffffffffffffff166004600089815260200190815260200160002060030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b1515612a5357600080fd5b6004600088815260200190815260200160002060050186815481101515612a7657fe5b906000526020600020906005020160005b50600001546004600089815260200190815260200160002060050187815481101515612aaf57fe5b906000526020600020906005020160005b50600101600460008a815260200190815260200160002060050188815481101515612ae757fe5b906000526020600020906005020160005b50600201600460008b815260200190815260200160002060050189815481101515612b1f57fe5b906000526020600020906005020160005b5060030154600460008c81526020019081526020016000206005018a815481101515612b5857fe5b906000526020600020906005020160005b5060040154838054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612c035780601f10612bd857610100808354040283529160200191612c03565b820191906000526020600020905b815481529060010190602001808311612be657829003601f168201915b50505050509350828054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612c9f5780601f10612c7457610100808354040283529160200191612c9f565b820191906000526020600020905b815481529060010190602001808311612c8257829003601f168201915b50505050509250945094509450945094505b9295509295909350565b6000612cc5613087565b60008060018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141515612d1857600080fd5b60026000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060040187815481101515612d6b57fe5b906000526020600020900160005b505481526020019081526020016000206000015460026000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060040188815481101515612de057fe5b906000526020600020900160005b5054815260200190815260200160002060010160026000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060040189815481101515612e5457fe5b906000526020600020900160005b505481526020019081526020016000206002015460026000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206004018a815481101515612ec957fe5b906000526020600020900160005b5054815260200190815260200160002060030154828054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612f805780601f10612f5557610100808354040283529160200191612f80565b820191906000526020600020905b815481529060010190602001808311612f6357829003601f168201915b5050505050925093509350935093505b9193509193565b60055481565b60046020528060005260406000206000915090508060000154908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060040154908060060154905086565b6000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206004018054905090505b90565b602060405190810160405280600081525090565b8154818355818115116130c2578183600052602060002091820191016130c19190613225565b5b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061310857805160ff1916838001178555613136565b82800160010185558215613136579182015b8281111561313557825182559160200191906001019061311a565b5b5090506131439190613225565b5090565b81548183558181151161317457600502816005028360005260206000209182019101613173919061324a565b5b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106131ba57805160ff19168380011785556131e8565b828001600101855582156131e8579182015b828111156131e75782518255916020019190600101906131cc565b5b5090506131f59190613225565b5090565b8154818355818115116132205781836000526020600020918201910161321f9190613225565b5b505050565b61324791905b8082111561324357600081600090555060010161322b565b5090565b90565b61329e91905b8082111561329a5760008082016000905560018201600061327191906132a1565b60028201600061328191906132a1565b6003820160009055600482016000905550600501613250565b5090565b90565b50805460018160011615610100020316600290046000825580601f106132c757506132e6565b601f0160209004906000526020600020908101906132e59190613225565b5b505600a165627a7a723058205a3f077353d581276e453f506c13cbd96a20a0214619943411ad8195977d4bbf0029"

Meteor.setInterval(function(){
	myContract = web3.eth.contract(ABIArray).at(contractAddress);
},500);

entities = new Mongo.Collection(null);
medicine = new Mongo.Collection(null);
trips = new Mongo.Collection(null);
tripdata = new Mongo.Collection(null);
transporters = new Mongo.Collection(null);
distributors = new Mongo.Collection(null);



// -----------------------LOGIN---------------------------------//
Template.login.onCreated(function loginOnCreated(){
	var template = Template.instance();
	this.sessionid = new ReactiveVar(0);
	this.username = new ReactiveVar();

});

Template.login.events({
	'click #button-login'(event, instance){

		console.log("HERE");

		var template = Template.instance();
		var abc = myContract.determineMTD(function (err, res){
		instance.sessionid.set(res);
		console.log(res);

		});

		var pqr = myContract.getUsername(function (err, res){
		instance.username.set(res);
			console.log(res);
		 });
	},

});

Template.login.helpers({
	username: function(){
		return Template.instance().username.get();
	},
	sessionid: function(){
		return Template.instance().sessionid.get();
	},

	det0()
	{
		if(Template.instance().sessionid.get()==8) return 1;
		else return 0;
	},

	det1()
	{
		if(Template.instance().sessionid.get()==1) return 1;
		else return 0;
	},

	det2()
	{
		if(Template.instance().sessionid.get()==2) return 1;
		else return 0;
	},

	det3()
	{
		if(Template.instance().sessionid.get()==3) return 1;
		else return 0;
	},
});
// ---------------------!!LOGIN!!-------------------------------//


// -----------------------ADMIN---------------------------------//
Template.admin.events({

	//Adds entity to contract
	'submit .entity-entry'(event){
		event.preventDefault();

		var mtd        = event.target.mtd.value;
		var entityAddr = event.target.entityAddr.value;
		var entityName = event.target.entityName.value;

		var template = Template.instance();

		myContract.addEntity(mtd, entityAddr, entityName, {data: code}, function (err, res){
			console.log(err);
		});

		event.target.mtd.value = " ";
		event.target.entityAddr.value = " ";
		event.target.entityName.value = " ";
	},


	//Returns all entities from contract
	'click #view-entity'(event, instance){
        temp_list = [];
		var template = Template.instance();
		entities.remove({});
		var pqr = myContract.entityLength(function (err, res){
			for(var i=0; i<res; i++)
			{
					myContract.allEntity(i, function (err, res2){
					myContract.viewEntity(res2, function (err, res3){
						console.log(res3);
						temp_list.push(res3);
						TemplateVar.set(template,"ent",res3);
						if(res3[2]['c']=="1")
							entities.insert({address: res3[0] ,name:res3[1], mtd:"Manufacturer"});
						if(res3[2]['c']=="2")
							entities.insert({address: res3[0] ,name:res3[1], mtd:"Transporter"});
						if(res3[2]['c']=="3")
							entities.insert({address: res3[0] ,name:res3[1], mtd:"Distributor"});
					});
				});
			}
		});
	},

});

Template.admin.helpers({
	all_list: function() {
		return entities.find();
			},

});
// ---------------------!!ADMIN!!-------------------------------//


//--------------------MANUFACTURER------------------------------//
Template.manufacturer.events({

	//Adds medicine to contract
	'submit .medicine-entry'(event){
		event.preventDefault();

		var medicineIndex = event.target.medicineIndex.value;
		var medicineName = event.target.medicineName.value;
		var maxTemp = event.target.maxTemp.value;
		var minTemp = event.target.minTemp.value;

		var template = Template.instance();

		myContract.addMedicine(medicineIndex, medicineName, maxTemp, minTemp, {data: code}, function (err, res){});

		event.target.medicineIndex.value = "";
		event.target.medicineName.value = "";
		event.target.maxTemp.value = "";
		event.target.minTemp.value = "";

	},

	//Fills form with data to start a "trip" on the contract
	'click #add-trips'(event, instance){
		console.log("here");
					temp_list = [];
			var template = Template.instance();
			transporters.remove({});
			distributors.remove({});
			medicine.remove({});
			var pqr = myContract.entityLength(function (err, res){
				console.log("Entity lengh function:");
				console.log(res);
					for(var i=0; i<res; i++){
						myContract.getTransporters(i, function(err, res2){
							if(res2!=null){
								transporters.insert({address:res2[0], name:res2[1]});
							}
						});
					}
					for(var i=0; i<res; i++){
						myContract.getDistributor(i, function(err, res2){
							if(res2!=null){
								distributors.insert({address:res2[0], name:res2[1]});
							}
						});
					}
			});

			var abc = myContract.medicineLength(function (err, res){
				for(var i=0; i<res; i++)
				{
					myContract.viewMedicine(i, function (err, res2){
						if(res2[1]!="")
							medicine.insert({index:res2[0]['c'], name:res2[1], maxTemp:res2[2]['c'], minTemp:res2[3]['c']});
					});
				}
			})

	},

	//Returns all medicines of current manufacturer
	'click #view-medicines'(event, instance){

        temp_list = [];
		var template = Template.instance();
		medicine.remove({});
		var pqr = myContract.medicineLength(function (err, res){
		console.log(res);
			for(var i=0; i<res; i++)
			{
				myContract.viewMedicine(i, function (err, res2){
					if(res2[1]!=""){
							medicine.insert({index:res2[0]['c'], name:res2[1], maxTemp:res2[2]['c'], minTemp:res2[3]['c']});
					}
				});
			}
		})

	},


	//Initailises a "trip" on the contract with form data
	'submit .start-trip'(event){
        event.preventDefault();

        var transporterAddr = event.target.transporterAddr.value;
		var distributorAddr = event.target.distributorAddr.value;
		var medicineIndex = event.target.medicineIndex.value;

		var template = Template.instance();
		myContract.startTrip(transporterAddr, distributorAddr, medicineIndex, {data: code}, function (err, res){console.log(res);});

		event.target.transporterAddr.value = " ";
		event.target.distributorAddr.value = " ";
		event.target.medicineIndex.value = " ";
	},


	//Returns all "trip"s of current manufacturer
	'click #view-trip'(event, instance){
        var template = Template.instance();
				trips.remove({});
		var pqr = myContract.lengthTrips(function (err, res){
			for(var i=0;i<res; i++)
			{
				myContract.displayTrips(i, function (err, res2){
					console.log(res2);
					if(res2[5]['c']=="0")
						trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], status:"Transit"});
							//entities.insert({address: res3[0] ,name:res3[1], mtd:"Manufacturer"});
					if(res2[5]['c']=="1")
						trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], status: "Accept"});
					if(res2[5]['c']=="2")
						trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], status: "Reject"});

				});
			}
		});
	},
});

Template.manufacturer.helpers({
	all_meds: function() {
		return medicine.find();
			},
	all_transporters: function(){
		return transporters.find();
	},
	all_distributors: function(){
		return distributors.find();
	},
	all_trips: function() {
		return trips.find();
			},
			trip_data: function() {
		return tripdata.find();
	},
});
//------------------!!MANUFACTURER!!----------------------------//


//--------------------TRANSPORTER------------------------------//
Template.transporter.events({

	//Uploads location and temperature data to contract
	'submit .send-data'(event){
		event.preventDefault();

		var temp = event.target.temp.value;
		var lat = event.target.lat.value;
		var lon = event.target.lon.value;

		var template = Template.instance();
		myContract.sendData(temp, lat, lon, {data: code}, function (err, res){console.log(res);});

		event.target.temp.value = " ";
		event.target.lat.value = " ";
		event.target.lon.value = " ";



	},
});
//------------------!!TRANSPORTER!!----------------------------//


//--------------------DISTRIBUTOR------------------------------//
Template.distributor.onCreated(function (){
	var template = Template.instance();
	this.tripVar = new ReactiveVar(0);
	this.tempDanger = new ReactiveVar(0);

});

Template.distributor.events({

	//Returns all active "trip"s of current distributor
	'click #view-trip'(event, instance){
        var template = Template.instance();
        trips.remove({});
		var pqr = myContract.lengthTrips(function (err, res){
			//console.log(res);
			for(var i=0;i<res; i++)
			{
				myContract.displayTrips(i, function (err, res2){

					if(res2[5]['c']=="0"){
						console.log(res2[4]['c']);
						trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], index:res2[4]['c'], status:"Transit"});
					}

				});
			}
		});
	},

	//Returns the transport data of a particular "trip"
	'click .view-data'(event, instance){
		var tripIndex = event.target.id;
		instance.tripVar.set(tripIndex);
		var template = Template.instance();
		tripdata.remove({});
		var pqr = myContract.lengthData(tripIndex, function (err, res){
			console.log(res);
			for(var z=0;z<res['c']; z++)
			{
				myContract.viewData(tripIndex, z, function (err, res2){
					console.log(res2);
					if(res2!=null){
						tripdata.insert({temp:res2[0]['c'], lat:res2[1], lon:res2[2], timestamp:res2[3]['c'], danger:res2[4]['c']});
					}
				});
			}
		});
	},

	//Marks delivery as accepted on the contract
	'click .accept-medicine'(event, instance){
        temp_list = [];

		var index = Number(event.currentTarget.value);
		console.log(index);
		 var template = Template.instance();
		 var pqr = myContract.acceptTrip(index, 1, function (err, res){
		});
	},

	//Marks delivery as rejected on the contract
	'click .reject-medicine'(event, instance){
        temp_list = [];

				var tripIndex = Number(event.currentTarget.value);
				console.log(tripIndex);
				 var template = Template.instance();
				 var pqr = myContract.acceptTrip(tripIndex, 2, function (err, res){
				});
	},

	//Returns all "trip"s in history of current disrtibuor with status
	'click #view-all'(event, instance){
		var template = Template.instance();
		trips.remove({});
		var pqr = myContract.lengthTrips(function (err, res){
			console.log(res);
			for(var i=0;i<res; i++)
			{
				myContract.displayTrips(i, function (err, res2){
				console.log(res2);
				if(res2[5]['c']=="0")
					trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], index:res2[4]['c'], status:"Transit", color:res2[5]['c']});
				if(res2[5]['c']=="1")
					trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], index:res2[4]['c'], status: "Accepted", color:res2[5]['c']});
				if(res2[5]['c']=="2")
					trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], index:res2[4]['c'], status: "Rejected", color:res2[5]['c']});

				});
			}
		});
	},

	//Returns all "trip"s in history of current disrtibuor which have been accepted
	'click #view-accepts'(event, instance){
        var template = Template.instance();
        trips.remove({});
		var pqr = myContract.lengthTrips(function (err, res){
			console.log(res);
			for(var i=0;i<res; i++)
			{
				myContract.displayTrips(i, function (err, res2){
					console.log(res2);
					if(res2[5]['c']=="1")
						trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], index:res2[4]['c'], status:res2[5]['c']});
				});
			}
		});
	},

	//Returns all "trip"s in history of current disrtibuor which have been rejected
	'click #view-rejects'(event, instance){
        var template = Template.instance();
        trips.remove({});
		var pqr = myContract.lengthTrips(function (err, res){
			console.log(res);
			for(var i=0;i<res; i++)
			{
				myContract.displayTrips(i, function (err, res2){
					console.log(res2);
					if(res2[5]['c']=="2")
						trips.insert({ma:res2[0], ta:res2[1], da:res2[2], medi:res2[3], index:res2[4]['c'], status:res2[5]['c']});
				});
			}
		});
	},

});

Template.distributor.helpers({

	tripVar: function(){
		return Template.instance().tripVar.get();
	},
	equals: function(v1, v2) {
        return (v1 == v2);
    },
	all_list: function() {
		return trips.find();
			},
	trip_data: function() {
		return tripdata.find();
	},
	trip_index: function(){
		return tripNo.find();
	},
});
//------------------!!DISTRIBUTOR!!----------------------------//
